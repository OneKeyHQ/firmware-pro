from common import *
import json

if not utils.BITCOIN_ONLY:
    from apps.ur_registry import account


@unittest.skipUnless(not utils.BITCOIN_ONLY, "altcoin")
class TestCryptoHdPKeyEncode(unittest.TestCase):
    def test_parse_crypto_hd_key(self):
        hd_key_cbor = unhexlify("a902f403582102cc6d7834204653ff10e0047a2395343cc6df081e76c88d5eee83f346f0b21cb7045820712a9187e5c60c573a5acce855445376e1b74c240e417fe8cb2a8fdfd78d2d9d05d90131a201183c020006d90130a30186182cf5183cf500f5021af23f9fd2030307d90130a2018400f480f40300081a483c932809684b657973746f6e650a706163636f756e742e7374616e64617264")

        resp = account.Account.parse_crypto_hd_key("crypto-hdkey", hd_key_cbor)
        resp_json = json.loads(resp)
        self.assertEqual(resp_json["chain"], "ETH")
        self.assertEqual(resp_json["path"], "m/44'/60'/0'")
        self.assertEqual(resp_json["public_key"], "02cc6d7834204653ff10e0047a2395343cc6df081e76c88d5eee83f346f0b21cb7")
        self.assertEqual(resp_json["name"], "Keystone")
        self.assertEqual(resp_json["chain_code"], "712a9187e5c60c573a5acce855445376e1b74c240e417fe8cb2a8fdfd78d2d9d")
        self.assertEqual(resp_json["extended_public_key"], "xpub6CBZfsQuZgVnvTcScAAXSxtX5jdMHtX5LdRuygnTScMBbKyjsxznd8XMEqDntdY1jigmjunwRwHsQs3xusYQBVFbvLdN4YLzH8caLSSiAoV")
        self.assertEqual(resp_json["note"], "account.standard")
        self.assertEqual(resp_json["xfp"], "f23f9fd2")
        self.assertEqual(resp_json["extra"], {'okx': {'chain_id': 1}})

    def test_parse_crypto_hd_key_wrong_type(self):
        hd_key_cbor = unhexlify("A2011A52006EA0028AD9012FA502F403582102FEF03A2BD3DE113F1DC1CDB1E69AA4D935DC3458D542D796F5827ABBB1A58B5E06D90130A3018A182CF5183CF500F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665D9012FA502F4035821033F1EDDF1D1BB2762FCFA67FBC35E12DC9968CD2587ADA055210E84F780C1109A06D90130A3018A182CF5183CF501F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665D9012FA502F403582102C5FCF766AD77A0C254834D57CE3E6120A2BE5C266E9BABE8A047D1A53CB34F9E06D90130A3018A182CF5183CF502F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665D9012FA502F403582102CD0B648CF944CBA7E6BE97BF1F17F0EAB7B9E600D181C421B3BCE6E7F6D941F006D90130A3018A182CF5183CF503F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665D9012FA502F40358210351F72104E737E94C7CC66E33307C74D5BBF19216800157AD34EBFE232F23C75106D90130A3018A182CF5183CF504F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665D9012FA502F403582102037F8C5FC1074E654FF11619A8BF28DCC3DB5D037191F08EB5722252AF57A4A606D90130A3018A182CF5183CF505F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665D9012FA502F403582103A441895DFBE9C7B3BF8EBA0CE461465A14350D902DF163A0B3F06E4F4843E54F06D90130A3018A182CF5183CF506F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665D9012FA502F403582102A8DCDF480733A5B7FB331C9464B7E0EDF5206D8581FE3E26BFD6DE38C8063D4C06D90130A3018A182CF5183CF507F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665D9012FA502F4035821037A1A6A48B09D4E3A01223B37C9D1212D8DA20746302009956168E1EA3BD3E0C806D90130A3018A182CF5183CF508F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665D9012FA502F403582103C6F04A813F23799940B6FA44C6CA48ABE04DE9FBB8133B7342DBABC95B0EA48106D90130A3018A182CF5183CF509F500F400F4021A52006EA0030509684B657973746F6E650A736163636F756E742E6C65646765725F6C697665")
        resp = account.Account.parse_crypto_hd_key("crypto-account", hd_key_cbor)
        self.assertEqual(resp, '{"error": "type not match"}')

if __name__ == '__main__':
    unittest.main()
